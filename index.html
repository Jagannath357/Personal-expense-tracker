<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense-Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
        integrity="sha384-tViUnnbYAV00FLIhhi3v/dWt3Jxw4gZQcNoSCxCIFNJVCx7/D55/wXsrNIRANwdD" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="Website Icon" type="png" href="images/logo.png" class="rounded-circle">
        <style>
            body{
                background-color: rgb(216, 253, 255);
            }
            
            .message{
                font-family: 'Gill Sans', 'Gill Sans MT', 'Calibri', 'Trebuchet MS', sans-serif;
                font-size: 30px;
                font-weight: 400;
            }
            .outer{
            height: fit-content;
            background-color: rgb(147, 255, 181);
            border-radius: 10px;
        }
        .heading{
            color:transparent;
            background-image: linear-gradient(90deg,blue,red,orange,teal);
            -webkit-background-clip: text;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-size: 65px;
        }
        .nav-link{
            font-size: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 400;
        }
        </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light mt-3">
        <div class="container-fluid">
            <a href="#" class="navbarbrand">
                <img src="images/logo.png" class="img-fluid" alt="web-logo" width="50">
            </a>
            <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar">
                <li class="bi bi-list"></li>
            </button>
            <div class="collapse navbar-collapse" id="navbar">
                <div class="navbar-nav ms-auto">
                    <a href="#" class="nav-item nav-link active mx-4">Home</a>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle mx-4" data-bs-toggle="dropdown">About Us</a>
                        <div class="dropdown-menu">
                            <a href="#" class="dropdown-item">Company</a>
                            <a href="#" class="dropdown-item">Team</a>
                        </div>
                    </div>
                        <a href="#" class="nav-item nav-link mx-4">Contact Us</a>
                </div>
                <div class="navbar-nav ms-auto">
                    <form class="d-flex">
                        <div class="input-group">
                            <input type="search" class="form-control" placeholder="Search for...">
                            <button type="button" class="btn btn-info"><i class="bi bi-search"></i></button>
                        </div>
                    </form>
                    <a href="#" class="nav-item nav-link mx-5">Student Login</a>
                </div>
            </div>
        </div>
    </nav>
    <h1 class="text-center mb-5 mt-4 heading">Personal Expense Tracker</h1>    
    <div class="container mb-5">
        <div class="container mb-3 col-sm-8 col-md-8 col-lg-8">
            <div class="row">
                <div class="col-6">
                    <div class="text-start">
                        <button type="button" class="btn btn-primary ms-1" onclick="showExpenseModal()">Add Expense</button>
                    </div>
                </div>
                <div class="col-6 text-end">
                    <div class="btn-group pe-1">
                        <input type="search" id="searchExpense" name="searchExpense" placeholder="Search for description" style="border-radius: 5px;">
                        <button type="button" class="btn btn-primary" onclick="searchDescription()"><i class="bi bi-search"></i></button>
                        <button type="button" class="btn btn-secondary ms-1" id="cancelSearch" onclick="cancelSearch()" style="border-radius: 4px;">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    <div class="container col-sm-8 col-md-8 col-lg-8 mt-3">
    <div class="outer">
        <div class="text-center text-danger message pt-4 pb-4" id="remark">
            Amount can not be Zero or Empty
        </div>
    <div class="container pt-4 mt-2">
        <div class="row">
            <div class="col-4 text-center" style="font-size: larger;">
                <label class="text-success"><b>Total Income :</b></label>
                <b><span id="totalIncome">234</span></b>
            </div>
            <div class="col-4 text-center" style="font-size: larger;">
                <label class="text-success"><b>Total Expense :</b></label>
                <b><span id="totalExpense">234</span></b>
            </div>
            <div class="col-4 text-center" style="font-size: larger;">
                <label class="text-success"><b>Total Balance :</b></label>
                <b><span id="totalBalance">234</span></b>
            </div>
            
        </div>
    </div>
    <div class="container py-4 px-5 pb-5">

        <div class="d-flex justify-content-center">
            <div class="col-sm-12 col-md-12 col-lg-12">
                <div class="card bg-primary">
                    <div class="card-body">
                        <table class="table table-responsive table-hover table-info">
                            <thead class="text-center">
                                <th>Sl No.</th>
                                <th>Description</th>
                                <th>Date</th>
                                <th>Spent Amount</th>
                                <th></th>
                            </thead>
                            <tbody class="text-center " id="expenseTableBody">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>
    </div>
    <div class="modal fade" id="addExpenseModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="addExpenseModal">
        <form id="addExpenseForm">
            <div class="modal-dialog">
                <div class="modal-content" style="background-color: rgb(162, 255, 255);color: blue;">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addExpenseModalLable">Add Expense</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-1">
                            <label for="addExpenseDescription" class="form-label">Description<sup style="color: red;font-size: 17px;">*</sup></label>
                            <textarea class="form-control" id="addExpenseDescription" name="description" rows="3"
                                placeholder="Add Your Expense Description" required></textarea>
                        </div>
                        <div class="mb-1">
                            <label for="addExpenseExpenditureDate" class="form-label">Expenditure Date<sup style="color: red;font-size: 17px;">*</sup></label>
                            <input type="date" class="form-control" id="addExpenseExpenditureDate" name="date" rows="3" placeholder="Add Your Spent Amount" required>
                        </div>
                        <div class="mb-1">
                            <label for="addExpenseSpentAmount" class="form-label">Amount<sup style="color: red;font-size: 17px;">*</sup></label>
                            <input type="number" class="form-control" id="addExpenseSpentAmount" name="amount" rows="3" placeholder="Add Your Amount" required>
                        </div>
                        
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="width: 100px;">close</button>
                        <button type="button" class="btn btn-success" onclick="saveExpense()">Add Expense</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"
        integrity="sha512-2rNj2KJ+D8s1ceNasTIex6z4HWyOnEYLVC3FigGOmyQCZc2eBXKgOxQmo3oKLHyfcj53uz4QMsRCWNbLd32Q1g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script>
        document.getElementById("cancelSearch").hidden = true;
        createTableFromJSON();
        getTotalExpenditure();

        function showExpenseModal() {
            $("#addExpenseModal").modal('show');
        }

        function saveExpense() {
            $("#addExpenseModal").modal('hide');
            var dataArr = $("#addExpenseForm").serializeArray();

            var expenseObject = new Object();
            var storageObjectArr = [];
            var storageObject = localStorage.getItem("expenseStorage");
            for (var i in dataArr) {
                var name = dataArr[i]['name'];
                var value = dataArr[i]['value'];
                expenseObject[name] = value;
            }
            if (storageObject != null && storageObject != undefined && storageObject != '') {
                storageObjectArr = JSON.parse(storageObject);
                storageObjectArr.push(expenseObject);
            }
            else {
                storageObjectArr.push(expenseObject);
            }
            localStorage.setItem("expenseStorage", JSON.stringify(storageObjectArr));
            storageObjectArr = createTableFromJSON();
            localStorage.setItem("expenseStorage", JSON.stringify(storageObjectArr));

            $("#addExpenseForm").trigger('reset');
        }

        function createTableFromJSON() {
            var storageObjectArr = [];
            var storageObject = localStorage.getItem("expenseStorage");
            var storageObjectArr = JSON.parse(storageObject);
            var html = "";
            if (storageObject != null && storageObject != undefined && storageObject != '') {
                if (storageObjectArr && storageObjectArr.length > 0) {
                    let j = parseInt(storageObjectArr.length) - parseInt(1);
                    if(storageObjectArr[j]['amount'] != null && storageObjectArr[j]['amount'] != undefined && storageObjectArr[j]['amount'] != '' && storageObjectArr[j]['amount'] != 0){
                        for (let i in storageObjectArr) {
                            
                                var date = new Date(storageObjectArr[i]['date']);
                                date = date.toISOString();
                                date = date.split('T')[0];
                                html = html + '<tr>'
                                    + '<td>' + (parseInt(i) + 1) + '</td>'
                                    + '<td>' + storageObjectArr[i]['description'] + '</td>'
                                    + '<td>' + date + '</td>'
                                    + '<td>' + storageObjectArr[i]['amount'] + '</td>'
                                    + '<td>' + '<button type="button" class="btn btn-close" onclick="removeExpense('+i+')"></button>';
                            }
                        document.getElementById('remark').hidden = true;
                        getTotalExpenditure();
                    }
                    else
                    {
                            var temp = storageObjectArr.pop();
                            localStorage.setItem("expenseStorage", JSON.stringify(storageObjectArr));
                            for (let i in storageObjectArr) {
                            
                            var date = new Date(storageObjectArr[i]['date']);
                            date = date.toISOString();
                            date = date.split('T')[0];
                            html = html + '<tr>'
                                + '<td>' + (parseInt(i) + 1) + '</td>'
                                + '<td>' + storageObjectArr[i]['description'] + '</td>'
                                + '<td>' + date + '</td>'
                                + '<td>' + storageObjectArr[i]['amount'] + '</td>';
                            }
                                getTotalExpenditure();

                                document.getElementById('remark').hidden = false;                              
                    }
                }
                else {
                    html = '<tr><td colspan = "5">No Expense Details Added Yet</td></tr>';
                    document.getElementById('remark').hidden = true;
                    
                }
            }
            else {
                html = '<tr><td colspan = "5">No Expense Details Added Yet</td></tr>';
                document.getElementById('remark').hidden = true;
               }
            
            $("#expenseTableBody").html(html);
            return storageObjectArr;
        }

        function getTotalExpenditure() {
            var storageObjectArr = [];
            var storageObject = localStorage.getItem("expenseStorage");
            var storageObjectArr = JSON.parse(storageObject);
            var expense = 0;
            var income = 0;
            var balance = 0
            if (storageObject != null && storageObject != undefined && storageObject != '') {
                if (storageObjectArr && storageObjectArr.length > 0) {
                    for (let i in storageObjectArr) {

                        balance = parseInt(balance) + parseInt(storageObjectArr[i]['amount']);

                        if(parseInt(storageObjectArr[i]['amount']) < 0)
                        {
                            expense = parseInt(expense) + parseInt(storageObjectArr[i]['amount']);
                        }
                        else{
                            income = parseInt(income) + parseInt(storageObjectArr[i]['amount']);
                        }
                    }
                }
                else {
                    expense = income = balance = 0;
                }
            }
            else {
                expense = income = balance = 0;
            }
            $("#totalIncome").html(income);
            $("#totalExpense").html(expense);
            $("#totalBalance").html(balance);
        }

        function removeExpense(index){
            var storageObjectArr = [];
            var storageObject = localStorage.getItem("expenseStorage");
            var storageObjectArr = JSON.parse(storageObject);
            var html = '';
            var opinion = confirm(" Do you really want to delete this data \n This wiil permanently deleted from the List.");
            if(opinion){
                if (storageObject != null && storageObject != undefined && storageObject != '') {
                    storageObjectArr.splice(index,1);
                }
                localStorage.setItem("expenseStorage" , JSON.stringify(storageObjectArr));

                if (storageObject != null && storageObject != undefined && storageObject != '') {
                    if (storageObjectArr && storageObjectArr.length > 0) {
                        for (let i in storageObjectArr) {
                                
                            var date = new Date(storageObjectArr[i]['date']);
                            date = date.toISOString();
                            date = date.split('T')[0];
                            html = html + '<tr>'
                            + '<td>' + (parseInt(i) + 1) + '</td>'
                            + '<td>' + storageObjectArr[i]['description'] + '</td>'
                            + '<td>' + date + '</td>'
                            + '<td>' + storageObjectArr[i]['amount'] + '</td>'
                            + '<td>' + '<button type="button" class="btn btn-close" onclick="removeExpense('+i+')"></button>';
                        }
                        document.getElementById('remark').hidden = true;
                    }
                    else {
                        html = '<tr><td colspan = "5">No Expense Details Added Yet</td></tr>';
                        document.getElementById('remark').hidden = true;
                    }
                }
                else {
                    html = '<tr><td colspan = "5">No Expense Details Added Yet</td></tr>';
                    document.getElementById('remark').hidden = true;
                }
                
                $("#expenseTableBody").html(html);
                getTotalExpenditure();
            }
        }

        function searchDescription(){
            var storageObjectArr = [];
            var storageObject = localStorage.getItem("expenseStorage");
            var input = $("#searchExpense").val();
            var html = '';
            if (storageObject != null && storageObject != undefined && storageObject != '') {
                storageObjectArr = JSON.parse(storageObject);
                if (storageObjectArr && storageObjectArr.length > 0) {
                if(input != null && input != '' && input != undefined){
                            var count = 0;
                            for(let i in storageObjectArr){
                                if(input == storageObjectArr[i]['description']){
                                    count++;
                                    html = html + '<tr>'
                                                + '<td>' + parseInt(count) + '</td>'
                                                + '<td>' + storageObjectArr[i]['description'] + '</td>'
                                                + '<td>' + storageObjectArr[i]['date'] + '</td>'
                                                + '<td>' + storageObjectArr[i]['amount'] + '</td>'
                                                + '<td>' + '<button type="button" class="btn btn-close" onclick="removeExpense('+(parseInt(count)-1)+')"></button>'
                                                + '</tr>';
                                                
                                }
                            }
                            if(html == ''){
                                html = '<tr><td colspan="5" style="color:red;">No matching found!</td></tr>';
                            }
                    }else{
                        html = '<tr><td colspan="5" style="color:red;">Please Enter a Task!</td></tr>';
                    }
                }else{
                        html = '<tr><td colspan="5" style="color:red;">No Task is there!</td></tr>';
                    }
                    
                }else{
                    html = '<tr><td colspan="5" style="color:red;>No Task is there!</td></tr>';
                }
                $("#expenseTableBody").html(html);
                getTotalExpenditure();
                document.getElementById("cancelSearch").hidden = false;

        }

        function cancelSearch(){
                createTableFromJSON();
                getTotalExpenditure();
                document.getElementById("cancelSearch").hidden = true;
                $("#searchExpense").val('');
            }
    </script>

</body>

</html>
